<% content_for :title, "New Page" %>

<div class="container py-4">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <h1>Create New Page</h1>
      
      <%= form_with model: @page, url: page_builder_pages_path, local: true, class: "mt-4" do |f| %>
        <% if @page.errors.any? %>
          <div class="alert alert-danger">
            <h5><%= pluralize(@page.errors.count, "error") %> prohibited this page from being saved:</h5>
            <ul class="mb-0">
              <% @page.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        <% end %>
        
        <div class="form-group mb-3">
          <%= f.label :title, class: "form-label" %>
          <%= f.text_field :title, class: "form-control", placeholder: "Enter page title" %>
        </div>
        
        <div class="form-group mb-3">
          <%= f.label :slug, class: "form-label" %>
          <%= f.text_field :slug, class: "form-control", placeholder: "page-url-slug (leave empty to auto-generate)" %>
          <small class="form-text text-muted">
            This will be the URL path for your page. Leave empty to auto-generate from title.
          </small>
        </div>
        
        <div class="form-group mb-3">
          <%= f.label :language, class: "form-label" %>
          <%= f.select :language, 
              options_for_select([
                ['English', 'en'],
                ['فارسی (Farsi)', 'fa']
              ], 'en'), 
              {}, 
              { class: "form-control" } %>
        </div>
        
        <div class="form-check mb-3">
          <%= f.check_box :published, class: "form-check-input" %>
          <%= f.label :published, "Publish immediately", class: "form-check-label" %>
        </div>
        
        <div class="form-group">
          <%= f.submit "Create Page", class: "btn btn-primary" %>
          <%= link_to "Cancel", page_builder_pages_path, class: "btn btn-secondary ml-2" %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<script>
// Auto-generate slug from title
document.addEventListener('DOMContentLoaded', function() {
  const titleField = document.querySelector('input[name="page[title]"]');
  const slugField = document.querySelector('input[name="page[slug]"]');
  
  if (titleField && slugField) {
    titleField.addEventListener('input', function() {
      if (slugField.value === '' || slugField.dataset.autoGenerated === 'true') {
        const slug = this.value
          .toLowerCase()
          .replace(/[^a-z0-9\u0600-\u06FF\s-]/g, '') // Allow Persian characters
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-')
          .replace(/^-|-$/g, '');
        
        slugField.value = slug;
        slugField.dataset.autoGenerated = 'true';
      }
    });
    
    slugField.addEventListener('input', function() {
      if (this.value !== '') {
        this.dataset.autoGenerated = 'false';
      }
    });
  }
});
</script>